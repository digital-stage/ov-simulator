{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/tobias/Developer/digitalstage/ov-simulator/libs/useStage.tsx\";\nimport { createContext, useContext, useEffect, useReducer, useState } from \"react\";\nimport StageMemberReducer, { addStageMember } from \"../utils/reducers/StageMemberReducer\";\nimport CustomStageMemberReducer from \"../utils/reducers/CustomStageMemberReducer\";\nimport TrackReducer from \"../utils/reducers/TrackReducer\";\nimport SoundCardReducer from \"../utils/reducers/SoundCardReducer\";\nimport RemoteTrackReducer from \"../utils/reducers/RemoteTrackReducer\";\nimport { TeckosClientWithJWT } from \"teckos-client\";\nimport TrackPresetReducer from \"../utils/reducers/TrackPresetReducer\";\nimport { ServerDeviceEvents, ServerGlobalEvents, ServerStageEvents } from \"../utils/types/SocketEvents\";\nimport * as React from \"react\";\nimport CustomRemoteTrackReducer from \"../utils/reducers/CustomRemoteTrackReducer\";\nconst InitialState = {\n  soundCards: {\n    byId: {},\n    allIds: []\n  },\n  presets: {\n    byId: {},\n    bySoundCard: {},\n    allIds: []\n  },\n  tracks: {\n    byId: {},\n    bySoundCard: {},\n    byPreset: {},\n    allIds: []\n  },\n  stageMembers: {\n    byId: {},\n    byGroup: {},\n    allIds: []\n  },\n  customStageMembers: {\n    byId: {},\n    byStageMember: {},\n    allIds: []\n  },\n  remoteTracks: {\n    byId: {},\n    byStageMember: {},\n    allIds: []\n  },\n  customRemoteTracks: {\n    byId: {},\n    byRemoteTrack: {},\n    allIds: []\n  }\n};\nconst Context = /*#__PURE__*/createContext(InitialState);\n\nconst StageProvider = props => {\n  const {\n    children,\n    token\n  } = props;\n  const {\n    1: setSocket\n  } = useState();\n  const {\n    0: device,\n    1: setDevice\n  } = useState(); // OV related entities\n\n  const {\n    0: soundCards,\n    1: dispatchSoundCard\n  } = useReducer(SoundCardReducer, InitialState.soundCards);\n  const {\n    0: presets,\n    1: dispatchPresets\n  } = useReducer(TrackPresetReducer, InitialState.presets);\n  const {\n    0: tracks,\n    1: dispatchTracks\n  } = useReducer(TrackReducer, InitialState.tracks); // Digital stage related entities\n\n  const {\n    0: groups,\n    1: dispatchGroups\n  } = useReducer(StageMemberReducer, InitialState.groups);\n  const {\n    0: customGroups,\n    1: dispatchCustomGroups\n  } = useReducer(StageMemberReducer, InitialState.customGroups);\n  const {\n    0: stageMembers,\n    1: dispatchStageMembers\n  } = useReducer(StageMemberReducer, InitialState.stageMembers);\n  const {\n    0: customStageMembers,\n    1: dispatchCustomStageMembers\n  } = useReducer(CustomStageMemberReducer, InitialState.customStageMembers);\n  const {\n    0: remoteTracks,\n    1: dispatchRemoteTracks\n  } = useReducer(RemoteTrackReducer, InitialState.remoteTracks);\n  const {\n    0: customRemoteTracks,\n    1: dispatchCustomRemoteTracks\n  } = useReducer(CustomRemoteTrackReducer, InitialState.customRemoteTracks);\n  useEffect(() => {\n    // Got token, register self as device\n    const initialDevice = {\n      name: 'OV Simulator',\n      canOv: true,\n      canAudio: true,\n      sendAudio: true,\n      receiveAudio: true,\n      soundCardIds: []\n    };\n    const nSocket = new TeckosClientWithJWT(process.env.NEXT_PUBLIC_API_URL, {\n      reconnection: true,\n      timeout: 1000\n    }, token, {\n      device: initialDevice\n    });\n    nSocket.on(\"connect\", () => {\n      console.log(\"connected!\");\n    });\n    nSocket.on(ServerDeviceEvents.LOCAL_DEVICE_READY, device => {\n      setDevice(device);\n    });\n    nSocket.on(ServerDeviceEvents.SOUND_CARD_ADDED, payload => dispatchSoundCard({\n      type: ServerDeviceEvents.SOUND_CARD_ADDED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.SOUND_CARD_CHANGED, payload => dispatchSoundCard({\n      type: ServerDeviceEvents.SOUND_CARD_CHANGED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.SOUND_CARD_REMOVED, payload => dispatchSoundCard({\n      type: ServerDeviceEvents.SOUND_CARD_REMOVED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.TRACK_PRESET_ADDED, payload => dispatchPresets({\n      type: ServerDeviceEvents.TRACK_PRESET_ADDED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.TRACK_PRESET_CHANGED, payload => dispatchPresets({\n      type: ServerDeviceEvents.TRACK_PRESET_CHANGED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.TRACK_PRESET_REMOVED, payload => dispatchPresets({\n      type: ServerDeviceEvents.TRACK_PRESET_REMOVED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.TRACK_ADDED, payload => dispatchTracks({\n      type: ServerDeviceEvents.TRACK_ADDED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.TRACK_CHANGED, payload => dispatchTracks({\n      type: ServerDeviceEvents.TRACK_CHANGED,\n      payload: payload\n    }));\n    nSocket.on(ServerDeviceEvents.TRACK_REMOVED, payload => dispatchTracks({\n      type: ServerDeviceEvents.TRACK_REMOVED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.STAGE_MEMBER_ADDED, payload => dispatchStageMembers({\n      type: ServerStageEvents.STAGE_MEMBER_ADDED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.STAGE_MEMBER_CHANGED, payload => dispatchStageMembers({\n      type: ServerStageEvents.STAGE_MEMBER_CHANGED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.STAGE_MEMBER_REMOVED, payload => dispatchStageMembers({\n      type: ServerStageEvents.STAGE_MEMBER_REMOVED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_ADDED, payload => dispatchCustomStageMembers({\n      type: ServerStageEvents.CUSTOM_STAGE_MEMBER_ADDED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_CHANGED, payload => dispatchCustomStageMembers({\n      type: ServerStageEvents.CUSTOM_STAGE_MEMBER_CHANGED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_REMOVED, payload => dispatchCustomStageMembers({\n      type: ServerStageEvents.CUSTOM_STAGE_MEMBER_REMOVED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.STAGE_MEMBER_OV_ADDED, payload => dispatchRemoteTracks({\n      type: ServerStageEvents.STAGE_MEMBER_OV_ADDED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.STAGE_MEMBER_OV_CHANGED, payload => dispatchRemoteTracks({\n      type: ServerStageEvents.STAGE_MEMBER_OV_CHANGED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.STAGE_MEMBER_OV_REMOVED, payload => dispatchRemoteTracks({\n      type: ServerStageEvents.STAGE_MEMBER_OV_REMOVED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_ADDED, payload => dispatchCustomRemoteTracks({\n      type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_ADDED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_CHANGED, payload => dispatchCustomRemoteTracks({\n      type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_CHANGED,\n      payload: payload\n    }));\n    nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_REMOVED, payload => dispatchCustomRemoteTracks({\n      type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_REMOVED,\n      payload: payload\n    }));\n    nSocket.on(ServerGlobalEvents.STAGE_JOINED, payload => {\n      // Handle package with many stage related entities\n      payload.stageMembers.forEach(stageMember => dispatchStageMembers(addStageMember(stageMember)));\n      payload.customStageMembers.forEach(customStageMember => dispatchCustomStageMembers({\n        type: ServerStageEvents.CUSTOM_STAGE_MEMBER_ADDED,\n        payload: customStageMember\n      }));\n      payload.ovTracks.forEach(ovTrack => dispatchRemoteTracks({\n        type: ServerStageEvents.STAGE_MEMBER_OV_ADDED,\n        payload: ovTrack\n      }));\n      payload.customOvTracks.forEach(customRemoteTrack => dispatchCustomRemoteTracks({\n        type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_ADDED,\n        payload: customRemoteTrack\n      }));\n    });\n    nSocket.connect();\n    setSocket(nSocket);\n  }, [token]);\n  return /*#__PURE__*/_jsxDEV(Context.Provider, {\n    value: {\n      device,\n      soundCards,\n      presets,\n      tracks,\n      stageMembers,\n      customStageMembers,\n      remoteTracks,\n      customRemoteTracks\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 248,\n    columnNumber: 9\n  }, this);\n};\n\nexport { StageProvider };\n\nconst useStage = () => useContext(Context);\n\nexport default useStage;","map":{"version":3,"sources":["/Users/tobias/Developer/digitalstage/ov-simulator/libs/useStage.tsx"],"names":["createContext","useContext","useEffect","useReducer","useState","StageMemberReducer","addStageMember","CustomStageMemberReducer","TrackReducer","SoundCardReducer","RemoteTrackReducer","TeckosClientWithJWT","TrackPresetReducer","ServerDeviceEvents","ServerGlobalEvents","ServerStageEvents","React","CustomRemoteTrackReducer","InitialState","soundCards","byId","allIds","presets","bySoundCard","tracks","byPreset","stageMembers","byGroup","customStageMembers","byStageMember","remoteTracks","customRemoteTracks","byRemoteTrack","Context","StageProvider","props","children","token","setSocket","device","setDevice","dispatchSoundCard","dispatchPresets","dispatchTracks","groups","dispatchGroups","customGroups","dispatchCustomGroups","dispatchStageMembers","dispatchCustomStageMembers","dispatchRemoteTracks","dispatchCustomRemoteTracks","initialDevice","name","canOv","canAudio","sendAudio","receiveAudio","soundCardIds","nSocket","process","env","NEXT_PUBLIC_API_URL","reconnection","timeout","on","console","log","LOCAL_DEVICE_READY","SOUND_CARD_ADDED","payload","type","SOUND_CARD_CHANGED","SOUND_CARD_REMOVED","TRACK_PRESET_ADDED","TRACK_PRESET_CHANGED","TRACK_PRESET_REMOVED","TRACK_ADDED","TRACK_CHANGED","TRACK_REMOVED","STAGE_MEMBER_ADDED","STAGE_MEMBER_CHANGED","STAGE_MEMBER_REMOVED","CUSTOM_STAGE_MEMBER_ADDED","CUSTOM_STAGE_MEMBER_CHANGED","CUSTOM_STAGE_MEMBER_REMOVED","STAGE_MEMBER_OV_ADDED","STAGE_MEMBER_OV_CHANGED","STAGE_MEMBER_OV_REMOVED","CUSTOM_STAGE_MEMBER_OV_ADDED","CUSTOM_STAGE_MEMBER_OV_CHANGED","CUSTOM_STAGE_MEMBER_OV_REMOVED","STAGE_JOINED","forEach","stageMember","customStageMember","ovTracks","ovTrack","customOvTracks","customRemoteTrack","connect","useStage"],"mappings":"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","sourcesContent":["import {createContext, useContext, useEffect, useReducer, useState} from \"react\";\nimport StageMemberReducer, {\n    addStageMember,\n    changeStageMember, removeStageMember,\n    StageMembers\n} from \"../utils/reducers/StageMemberReducer\";\nimport CustomStageMemberReducer, {CustomStageMembers} from \"../utils/reducers/CustomStageMemberReducer\";\nimport TrackReducer, {Tracks} from \"../utils/reducers/TrackReducer\";\nimport SoundCardReducer, {SoundCards} from \"../utils/reducers/SoundCardReducer\";\nimport RemoteTrackReducer, {RemoteTracks} from \"../utils/reducers/RemoteTrackReducer\";\nimport {ITeckosClient, TeckosClientWithJWT} from \"teckos-client\";\nimport {Device} from \"../utils/types/Device\";\nimport TrackPresetReducer, {TrackPresets} from \"../utils/reducers/TrackPresetReducer\";\nimport {ServerDeviceEvents, ServerGlobalEvents, ServerStageEvents} from \"../utils/types/SocketEvents\";\nimport {InitialStagePackage} from \"../utils/types/InitialStagePackage\";\nimport * as React from \"react\";\nimport {StageMemberOvTrack} from \"../utils/types/StageMemberOvTrack\";\nimport CustomRemoteTrackReducer, {CustomRemoteTracks} from \"../utils/reducers/CustomRemoteTrackReducer\";\nimport {CustomRemoteOvTrack} from \"../utils/types/CustomRemoteOvTrack\";\nimport {SoundCard} from \"../utils/types/SoundCard\";\nimport {Track} from \"../utils/types/Track\";\nimport {TrackPreset} from \"../utils/types/TrackPreset\";\nimport {StageMember} from \"../utils/types/StageMember\";\nimport {CustomStageMember} from \"../utils/types/CustomStageMember\";\nimport {Groups} from \"../utils/reducers/GroupReducer\";\n\ninterface StageContext {\n    device?: Device;\n    soundCards: SoundCards;\n    presets: TrackPresets;\n    tracks: Tracks;\n\n    groups: Groups;\n    customGroups: CustomGroups;\n    stageMembers: StageMembers;\n    customStageMembers: CustomStageMembers;\n\n    remoteTracks: RemoteTracks;\n    customRemoteTracks: CustomRemoteTracks;\n}\n\nconst InitialState: StageContext = {\n    soundCards: {\n        byId: {},\n        allIds: []\n    },\n    presets: {\n        byId: {},\n        bySoundCard: {},\n        allIds: []\n    },\n    tracks: {\n        byId: {},\n        bySoundCard: {},\n        byPreset: {},\n        allIds: []\n    },\n    stageMembers: {\n        byId: {},\n        byGroup: {},\n        allIds: []\n    },\n    customStageMembers: {\n        byId: {},\n        byStageMember: {},\n        allIds: []\n    },\n    remoteTracks: {\n        byId: {},\n        byStageMember: {},\n        allIds: []\n    },\n    customRemoteTracks: {\n        byId: {},\n        byRemoteTrack: {},\n        allIds: []\n    }\n}\n\nconst Context = createContext<StageContext>(InitialState);\n\nconst StageProvider = (props: {\n    children: React.ReactNode,\n    token?: string\n}) => {\n    const {children, token} = props;\n    const [, setSocket] = useState<ITeckosClient>();\n    const [device, setDevice] = useState<Device>();\n\n    // OV related entities\n    const [soundCards, dispatchSoundCard] = useReducer(SoundCardReducer, InitialState.soundCards);\n    const [presets, dispatchPresets] = useReducer(TrackPresetReducer, InitialState.presets);\n    const [tracks, dispatchTracks] = useReducer(TrackReducer, InitialState.tracks);\n\n    // Digital stage related entities\n    const [groups, dispatchGroups] = useReducer(StageMemberReducer, InitialState.groups);\n    const [customGroups, dispatchCustomGroups] = useReducer(StageMemberReducer, InitialState.customGroups);\n    const [stageMembers, dispatchStageMembers] = useReducer(StageMemberReducer, InitialState.stageMembers);\n    const [customStageMembers, dispatchCustomStageMembers] = useReducer(CustomStageMemberReducer, InitialState.customStageMembers);\n    const [remoteTracks, dispatchRemoteTracks] = useReducer(RemoteTrackReducer, InitialState.remoteTracks);\n    const [customRemoteTracks, dispatchCustomRemoteTracks] = useReducer(CustomRemoteTrackReducer, InitialState.customRemoteTracks);\n\n    useEffect(() => {\n        // Got token, register self as device\n        const initialDevice: Partial<Device> = {\n            name: 'OV Simulator',\n            canOv: true,\n            canAudio: true,\n            sendAudio: true,\n            receiveAudio: true,\n            soundCardIds: [],\n        };\n\n        const nSocket = new TeckosClientWithJWT(\n            process.env.NEXT_PUBLIC_API_URL,\n            {\n                reconnection: true,\n                timeout: 1000,\n            },\n            token,\n            {\n                device: initialDevice,\n            }\n        );\n\n        nSocket.on(\"connect\", () => {\n            console.log(\"connected!\")\n        });\n\n        nSocket.on(ServerDeviceEvents.LOCAL_DEVICE_READY, (device: Device) => {\n            setDevice(device);\n        })\n\n        nSocket.on(ServerDeviceEvents.SOUND_CARD_ADDED, (payload: SoundCard) => dispatchSoundCard({\n            type: ServerDeviceEvents.SOUND_CARD_ADDED,\n            payload: payload\n        }));\n        nSocket.on(ServerDeviceEvents.SOUND_CARD_CHANGED, (payload: SoundCard) => dispatchSoundCard({\n            type: ServerDeviceEvents.SOUND_CARD_CHANGED,\n            payload: payload\n        }));\n        nSocket.on(ServerDeviceEvents.SOUND_CARD_REMOVED, (payload: string) => dispatchSoundCard({\n            type: ServerDeviceEvents.SOUND_CARD_REMOVED,\n            payload: payload\n        }));\n\n        nSocket.on(ServerDeviceEvents.TRACK_PRESET_ADDED, (payload: TrackPreset) => dispatchPresets({\n            type: ServerDeviceEvents.TRACK_PRESET_ADDED,\n            payload: payload\n        }));\n        nSocket.on(ServerDeviceEvents.TRACK_PRESET_CHANGED, (payload: TrackPreset) => dispatchPresets({\n            type: ServerDeviceEvents.TRACK_PRESET_CHANGED,\n            payload: payload\n        }));\n        nSocket.on(ServerDeviceEvents.TRACK_PRESET_REMOVED, (payload: string) => dispatchPresets({\n            type: ServerDeviceEvents.TRACK_PRESET_REMOVED,\n            payload: payload\n        }));\n\n        nSocket.on(ServerDeviceEvents.TRACK_ADDED, (payload: Track) => dispatchTracks({\n            type: ServerDeviceEvents.TRACK_ADDED,\n            payload: payload\n        }));\n        nSocket.on(ServerDeviceEvents.TRACK_CHANGED, (payload: Track) => dispatchTracks({\n            type: ServerDeviceEvents.TRACK_CHANGED,\n            payload: payload\n        }));\n        nSocket.on(ServerDeviceEvents.TRACK_REMOVED, (payload: string) => dispatchTracks({\n            type: ServerDeviceEvents.TRACK_REMOVED,\n            payload: payload\n        }));\n\n        nSocket.on(ServerStageEvents.STAGE_MEMBER_ADDED, (payload: StageMember) => dispatchStageMembers({\n            type: ServerStageEvents.STAGE_MEMBER_ADDED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.STAGE_MEMBER_CHANGED, (payload: StageMember) => dispatchStageMembers({\n            type: ServerStageEvents.STAGE_MEMBER_CHANGED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.STAGE_MEMBER_REMOVED, (payload: string) => dispatchStageMembers({\n            type: ServerStageEvents.STAGE_MEMBER_REMOVED,\n            payload: payload\n        }));\n\n        nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_ADDED, (payload: CustomStageMember) => dispatchCustomStageMembers({\n            type: ServerStageEvents.CUSTOM_STAGE_MEMBER_ADDED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_CHANGED, (payload: CustomStageMember) => dispatchCustomStageMembers({\n            type: ServerStageEvents.CUSTOM_STAGE_MEMBER_CHANGED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_REMOVED, (payload: string) => dispatchCustomStageMembers({\n            type: ServerStageEvents.CUSTOM_STAGE_MEMBER_REMOVED,\n            payload: payload\n        }));\n\n        nSocket.on(ServerStageEvents.STAGE_MEMBER_OV_ADDED, (payload: StageMemberOvTrack) => dispatchRemoteTracks({\n            type: ServerStageEvents.STAGE_MEMBER_OV_ADDED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.STAGE_MEMBER_OV_CHANGED, (payload: StageMemberOvTrack) => dispatchRemoteTracks({\n            type: ServerStageEvents.STAGE_MEMBER_OV_CHANGED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.STAGE_MEMBER_OV_REMOVED, (payload: string) => dispatchRemoteTracks({\n            type: ServerStageEvents.STAGE_MEMBER_OV_REMOVED,\n            payload: payload\n        }));\n\n        nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_ADDED, (payload: CustomRemoteOvTrack) => dispatchCustomRemoteTracks({\n            type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_ADDED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_CHANGED, (payload: CustomRemoteOvTrack) => dispatchCustomRemoteTracks({\n            type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_CHANGED,\n            payload: payload\n        }));\n        nSocket.on(ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_REMOVED, (payload: string) => dispatchCustomRemoteTracks({\n            type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_REMOVED,\n            payload: payload\n        }));\n\n        nSocket.on(ServerGlobalEvents.STAGE_JOINED, (payload: InitialStagePackage) => {\n            // Handle package with many stage related entities\n            payload.stageMembers.forEach(stageMember => dispatchStageMembers(addStageMember(stageMember)));\n            payload.customStageMembers.forEach(customStageMember => dispatchCustomStageMembers({\n                type: ServerStageEvents.CUSTOM_STAGE_MEMBER_ADDED,\n                payload: customStageMember\n            }));\n            payload.ovTracks.forEach(ovTrack => dispatchRemoteTracks({\n                type: ServerStageEvents.STAGE_MEMBER_OV_ADDED,\n                payload: ovTrack\n            }));\n            payload.customOvTracks.forEach(customRemoteTrack => dispatchCustomRemoteTracks({\n                type: ServerStageEvents.CUSTOM_STAGE_MEMBER_OV_ADDED,\n                payload: customRemoteTrack\n            }));\n        });\n\n        nSocket.connect();\n\n        setSocket(nSocket);\n    }, [token])\n\n    return (\n        <Context.Provider value={{\n            device,\n            soundCards,\n            presets,\n            tracks,\n            stageMembers,\n            customStageMembers,\n            remoteTracks,\n            customRemoteTracks\n        }}>\n            {children}\n        </Context.Provider>\n    )\n};\n\nexport {\n    StageProvider\n}\n\nconst useStage = (): StageContext => useContext<StageContext>(Context);\nexport default useStage;\n"]},"metadata":{},"sourceType":"module"}